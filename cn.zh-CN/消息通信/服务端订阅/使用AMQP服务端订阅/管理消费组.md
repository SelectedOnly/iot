# 管理消费组

消费组是消息消费端的身份标识。物联网平台可将消息流转到指定的消费组，消息消费端以消费组身份接入物联网平台，并接收消息。

-   消费组的用途：

    -   使用AMQP服务端订阅功能，订阅某产品下全部设备的指定类型消息，并将消息流转到指定消费组。您的云端应用通过监听消费组获取消息。

        AMQP服务端订阅配置，请参见[配置AMQP服务端订阅](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/配置AMQP服务端订阅.md)。

    -   使用云产品流转功能，将指定Topic中的消息流转到AMQP服务端订阅消费组。您的云端应用通过监听消费组获取消息。

        设置云产品流转规则，请参见[设置数据流转规则](/cn.zh-CN/消息通信/云产品流转/设置数据流转规则.md)。

    服务端订阅和云产品流转的区别，请参见[数据流转方案对比](/cn.zh-CN/消息通信/云产品流转/数据流转方案对比.md)。

-   消费组的用法：将消费组ID配置到AMQP客户端上，AMQP客户端以消费组身份接入物联网平台，接收消息。

    多个AMQP客户端可以使用同一个消费组ID，组成消息消费集群。当设备消息到达时，物联网平台将消息随机发往消费组中的某一个客户端。一个消费组下最多可有64个客户端。

    具体配置说明，请参见[AMQP客户端接入说明](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/AMQP客户端接入说明.md)。


## 创建消费组

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。

2.  选择**规则引擎** \> **服务端订阅** \> **消费组列表**。

3.  单击**创建消费组**。

4.  在创建消费组对话框中，输入组名，单击**确认**。

    消费组名称支持中文、英文字母、日文、数字和下划线（\_），长度范围为4~30个字符。一个中文或日文占2个字符。


## 查看和监控消费组

您可以查看消费组内的消息消费速率、消息堆积量，也可以设置云监控报警规则来监控消费组。

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。

2.  选择**规则引擎** \> **服务端订阅** \> **消费组列表**。

3.  在消费组列表中，找到要查看的消费组，并单击对应的**查看**。

4.  在消费组状态页签下，查看订阅消息的消费速率、消息堆积量、最近消费时间和在线客户端列表。

    当消息堆积量大于等于（≥）1时，**消息堆积量**右侧会显示**清除**按钮，您可以清除堆积消息。

5.  配置云监控阈值报警规则，监控消费组消息堆积数、消费组消息消费速率，并接收报警消息。

    1.  在消费组状态页签下，单击**报警配置**。

    2.  在创建报警规则页，设置具体的阈值报警规则，单击**确认**。

        |项目|参数|说明|
        |--|:-|:-|
        |关联资源|产品|选择**物联网平台-服务端订阅**。|
        |资源范围|可选：        -   **所有资源**：包含所有实例下的所有消费组。
        -   **实例** |
        |地域|资源范围选择为**实例**时出现的参数。表示要监控的消费组所属的物联网平台实例所在地域。|
        |实例|选择要监控的物联网平台实例和消费组。消费组可多选。 指定消费组的消息堆积或消费速率满足报警规则描述时，才会发送报警通知。 |
        |设置报警规则|规则名称|设置报警规则名称。|
        |规则描述|定义在监控数据满足何种条件时，触发报警规则。设置项包括：         -   选择该规则监控的类目。
        -   选择规则执行扫描的周期。例如：选择为60分钟周期，表示以60分钟为周期进行扫描。
        -   设置报警条件。例如：连续3个周期内监控值大于1,000，则触发报警。 |
        |通道沉默周期|设置报警发生后，如果未恢复正常，间隔多久再次发送报警通知。|
        |生效时间|设置报警规则的执行时间范围。报警规则只在生效时间内发送报警通知。|
        |通知方式|通知对象|设置接收报警的联系人通知组。设置报警联系人，请参见[设置报警联系人](/cn.zh-CN/最佳实践/监控运维/使用云监控监控IoT资源/设置报警联系人.md)。|
        |报警级别|选择报警级别，分为三个等级，不同等级应用不同的通知策略：

        -   Critical：电话+短信+邮件+钉钉机器人通知。
        -   Warning：短信+邮件+钉钉机器人通知。
        -   Info：邮件+钉钉机器人通知。 |
        |弹性伸缩|选择是否应用弹性伸缩。选择后，会在发生报警时触发相应的伸缩规则。|
        |日志服务|选择是否应用日志服务。选择后，会将报警信息写入日志服务。|
        |邮件主题|资源范围选择为**实例**时出现的参数。填写发生报警时发送给通知对象的邮件的主题。默认主题为产品名称+监控项名称+实例ID。|
        |邮件备注|填写发生报警时发送给通知对象的邮件的备注。|
        |报警回调|填写公网可访问的URL，云监控会将报警信息通过POST请求推送到该地址。|


## 删除消费组

您创建的消费组可以删除，默认消费组不可删除。您可以通过删除消费组，使该组内的所有消费端停止接收消息。

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。

2.  选择**规则引擎** \> **服务端订阅** \> **消费组列表**。

3.  解除订阅。如果消费组已关联订阅关系，则需先解除订阅；若无订阅关系，请忽略此步骤。

    1.  单击消费组对应的**查看**。

    2.  在消费组详情页的订阅产品页签下，单击产品名对应的**解除订阅**，确认解除订阅关系的后果，再单击**确认**。

        **说明：** 如果该产品的服务端订阅只有一个消费组，则不能在消费组详情页解除订阅。需返回服务端订阅页，编辑订阅，更改消费组或删除订阅。

4.  在服务端订阅页的消费组列表页签下，单击消费组对应的**删除**，确认解除订阅关系的后果，再单击**确认**。


## 相关文档

将消费组ID配置到AMQP客户端上，以接收消息，请参见：

-   [AMQP客户端接入说明](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/AMQP客户端接入说明.md)
-   [Java SDK接入示例](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/Java SDK接入示例.md)
-   [Node.js SDK接入示例](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/Node.js SDK接入示例.md)
-   [.NET SDK接入示例](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/.NET SDK接入示例.md)
-   [Python 2.7 SDK接入示例](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/Python 2.7 SDK接入示例.md)
-   [Python3 SDK接入示例]()
-   [PHP SDK接入示例]()
-   [Go SDK接入示例](/cn.zh-CN/消息通信/服务端订阅/使用AMQP服务端订阅/Go SDK接入示例.md)

